import{p as Oe,m as Ae,a as Be,g as Ee,t as D,u as Re,c as R,b as Fe,s as pe,d as Ne,e as Ue,f as t,h as ae,i as q,V as Ge,j as He,r as A,w as Je,k as Le,o as h,l as J,n as B,q as le,v as L,x as l,y as ne,z as Me,F as oe,A as b,B as qe,C as se,D as ve,E as re,G as E,H as de,I as ie,J as he,K as ze,L as Ke,M as We,N as Z,O as Qe,P as Xe,Q as ge,_ as Ye,R as M,S as ye,T as Ze,U as Ce}from"./assets/axios-CXuHkYsP.js";import{V as Ve}from"./assets/VSpacer-B6XjHHdU.js";import{m as et,a as tt,c as at,b as lt,d as nt,u as ot,p as st,e as rt,f as dt,g as it,h as ut,i as ct,j as mt,V as be,k as _e,l as ke,n as ft,o as pt}from"./assets/VDataTable-CcyWH9Z-.js";const vt=Oe({...et(),...tt(),...Ae(),...Be()},"VDataTableVirtual"),xe=Ee()({name:"VDataTableVirtual",props:vt(),emits:{"update:modelValue":n=>!0,"update:sortBy":n=>!0,"update:options":n=>!0,"update:groupBy":n=>!0,"update:expanded":n=>!0},setup(n,z){let{attrs:K,slots:u}=z;const{groupBy:I}=at(n),{sortBy:w,multiSort:F,mustSort:c}=lt(n),{columns:S,headers:N,filterFunctions:_,sortFunctions:P,sortRawFunctions:$}=nt(n,{groupBy:I,showSelect:D(n,"showSelect"),showExpand:D(n,"showExpand")}),{items:U}=ot(n,S),W=D(n,"search"),{filteredItems:Q}=Re(n,U,W,{transform:T=>T.columns,customKeyFilter:_}),{toggleSort:j}=st({sortBy:w,multiSort:F,mustSort:c}),{sortByWithGroups:C,opened:X,extractRows:ee,isGroupOpen:o,toggleGroup:a}=rt({groupBy:I,sortBy:w}),{sortedItems:m}=dt(n,Q,C,P,$),{flatItems:d}=it(m,I,X),e=R(()=>ee(d.value)),{isSelected:k,select:f,selectAll:v,toggleSelect:g,someSelected:y,allSelected:x}=ut(n,{allItems:e,currentPage:e}),{isExpanded:Y,toggleExpand:s}=ct(n),{containerRef:r,markerRef:i,paddingTop:p,paddingBottom:G,computedItems:De,handleItemResize:Ie,handleScroll:we,handleScrollend:Se}=Fe(n,d),Pe=R(()=>De.value.map(T=>T.raw));mt({sortBy:w,page:pe(1),itemsPerPage:pe(-1),groupBy:I,search:W}),Ne({VDataTableRows:{hideNoData:D(n,"hideNoData"),noDataText:D(n,"noDataText"),loading:D(n,"loading"),loadingText:D(n,"loadingText")}});const H=R(()=>({sortBy:w.value,toggleSort:j,someSelected:y.value,allSelected:x.value,isSelected:k,select:f,selectAll:v,toggleSelect:g,isExpanded:Y,toggleExpand:s,isGroupOpen:o,toggleGroup:a,items:e.value.map(T=>T.raw),internalItems:e.value,groupedItems:d.value,columns:S.value,headers:N.value}));Ue(()=>{const T=be.filterProps(n),$e=_e.filterProps(n),je=ke.filterProps(n);return t(ke,q({class:["v-data-table",{"v-data-table--loading":n.loading},n.class],style:n.style},je),{top:()=>{var V;return(V=u.top)==null?void 0:V.call(u,H.value)},wrapper:()=>{var V,ue,ce;return t("div",{ref:r,onScrollPassive:we,onScrollend:Se,class:"v-table__wrapper",style:{height:ae(n.height)}},[t("table",null,[(V=u.colgroup)==null?void 0:V.call(u,H.value),t("thead",null,[t(be,q(T,{sticky:n.fixedHeader}),u)]),t("tbody",null,[t("tr",{ref:i,style:{height:ae(p.value),border:0}},[t("td",{colspan:S.value.length,style:{height:0,border:0}},null)]),(ue=u["body.prepend"])==null?void 0:ue.call(u,H.value),t(_e,q(K,$e,{items:Pe.value}),{...u,item:O=>t(Ge,{key:O.internalItem.index,renderless:!0,"onUpdate:height":te=>Ie(O.internalItem.index,te)},{default:te=>{var fe;let{itemRef:me}=te;return((fe=u.item)==null?void 0:fe.call(u,{...O,itemRef:me}))??t(ft,q(O.props,{ref:me,key:O.internalItem.index,index:O.internalItem.index}),u)}})}),(ce=u["body.append"])==null?void 0:ce.call(u,H.value),t("tr",{style:{height:ae(G.value),border:0}},[t("td",{colspan:S.value.length,style:{height:0,border:0}},null)])])])])},bottom:()=>{var V;return(V=u.bottom)==null?void 0:V.call(u,H.value)}})})}}),ht={id:"start-page"},gt={class:"text-h6 mx-3"},yt=["id"],Vt=["colspan"],bt={class:"text-h6 mx-3"},_t={key:0},kt=["colspan"],xt={class:"text-h6 mx-3"},Tt={__name:"App",props:["dataProviders","csrf"],setup(n){const z=He(),K=n,u=JSON.parse(K.dataProviders.replaceAll(", 'children': []","").replace(/'/g,'"')),I=K.csrf;function w(){const o={data:X.value};Xe.post("/saveElementsAndLinks/",o,{headers:{"X-CSRFToken":I,"Content-Type":"application/json"}}).then(function(a){P.value=!0,$.value=!1,ge(()=>{z("#start-page",{offset:0})})}).catch(a=>{$.value=!0,P.value=!1,ge(()=>{z("#start-page",{offset:0})})}).finally(()=>{_.value=!1})}const F=A(u),c=A({}),S=R(()=>F.value.length<2);function N(o,a){return[{title:"title",value:"title",key:o+"#domain#"+a}]}const _=A(!1),P=A(!1),$=A(!1);function U(o){return o.length>0?o[0].types:""}const W=R(()=>{const o=Object.keys(c.value).length;let a=!1,m=0;for(const[d,e]of Object.entries(c.value))e.length==0&&(m=m+1);return o-m<2&&(a=!0),!(o>1&&a===!1)});function Q(o,a){if(o===a)return!0;if(typeof o!="object"||typeof a!="object")return!1;const m=Object.keys(o),d=Object.keys(a);if(m.length!==d.length)return!1;for(const e of m)if(!d.includes(e)||!Q(o[e],a[e]))return!1;return!0}let j={...c};Je(c,o=>{for(const a in o)if(o[a]!==j[a]){const m=o[a]!==void 0?JSON.parse(JSON.stringify(o[a])):[],d=j[a]!==void 0?JSON.parse(JSON.stringify(j[a])):[],e=m.filter(s=>{const r=d.find(i=>i.id===s.id);return!r||!Q(s,r)}),k=d.filter(s=>!o[a].some(r=>r.id===s.id)),f=u.find(s=>s.title+"#domain#"+s.host===a),v=(s,r)=>{const i=y(s.parent,f.element);i&&(c.value[r].find(G=>G.id===i.id)||(c.value[r].push(i),v(i,r)))},g=(s,r)=>{if(s.children&&s.children.length>0)for(const i of s.children)c.value[r].find(G=>G.id===i.id)||(c.value[r].push(i),g(i,r))},y=(s,r)=>{for(const i of r){if(i.id===s)return i;if(i.children){const p=y(s,i.children);if(p)return p}}return null},x=(s,r)=>{for(const i of r){if(i.id===s)return i;if(i.children){const p=x(s,i.children);if(p)return p}}return null};for(const s of e){v(s,a);const r=x(s.id,f.element);r&&g(r,a)}const Y=(s,r)=>{if(s.children&&s.children.length>0)for(const i of s.children)c.value[r]=c.value[r].filter(p=>p.id!==i.id),Y(i,r)};for(const s of k){const r=x(s.id,f.element);r&&Y(r,a)}}j={...o}},{deep:!0});const C=o=>{const a={},m=[];return o.forEach(d=>{a[d.id]={...d,children:[]}}),o.forEach(d=>{d.parent!=="false"&&a[d.parent]?a[d.parent].children.push(a[d.id]):m.push(a[d.id])}),m},X=R(()=>{const o=[];let a=0;for(const m in c.value)if(c.value[m].length>0){const[d,e]=m.split("#domain#");F.value.find(f=>f.title===d);let k={id:m+a,title:d+" - "+e,provider:d,host:e,children:C(c.value[m])};o.push(k),a++}return o}),ee=A({Dataset:"$mdiDatabase",Experiment:"$mdiFlask",Image:"$mdiImage",Project:"$mdiFolderMultipleImage",Spectra:"$mdiWaveform",other:"$mdiFile"});return(o,a)=>{const m=Le("v-treeview"),d=Ye;return h(),J(oe,null,[B("div",ht,[t(le,{modelValue:P.value,"onUpdate:modelValue":a[0]||(a[0]=e=>P.value=e),text:"The link has been saved successfully",type:"success",density:"compact",closable:""},null,8,["modelValue"]),t(le,{modelValue:$.value,"onUpdate:modelValue":a[1]||(a[1]=e=>$.value=e),text:"The link has not been saved due to an error, please try again.",type:"error",variant:"tonal",border:"top",density:"compact",closable:""},null,8,["modelValue"]),S.value?(h(),L(le,{key:0,type:"warning",density:"compact",closable:""},{default:l(()=>[b(" In addition to OMERO you need to add a second data provider, please add it and configure it correctly. ")]),_:1})):ne("",!0)]),t(Me,null,{default:l(()=>[t(qe,null,{default:l(()=>[t(se,{justify:"center"},{default:l(()=>[(h(!0),J(oe,null,ve(F.value,(e,k)=>(h(),L(re,{md:"3",key:e.title+e.host,cols:"auto"},{default:l(()=>[t(E,null,{default:l(()=>[t(de,{color:"#0377a1",flat:""},{default:l(()=>[t(ie,null,{default:l(()=>[b(M(e.title),1)]),_:2},1024)]),_:2},1024),t(he,null,{default:l(()=>[t(E,{color:"#0377a1",variant:"tonal",class:"mx-auto my-1 py-1 mx-n2"},{default:l(()=>[B("div",gt,M(U(e.element)),1)]),_:2},1024),t(pt,{modelValue:c.value[`${e.title}#domain#${e.host}`],"onUpdate:modelValue":f=>c.value[`${e.title}#domain#${e.host}`]=f,"items-per-page":"5",items:e.element,"item-value":"title","item-key":"id",headers:N(e.title,e.host),"return-object":"","show-select":"","show-expand":""},{"expanded-row":l(({columns:f,item:v})=>[v.children?(h(),J("tr",{key:0,id:v.id},[B("td",{colspan:f.length},[t(E,{color:"#0377a1",variant:"tonal",class:"mx-auto my-1 py-1 mx-n2"},{default:l(()=>[B("div",bt,M(U(v.children)),1)]),_:2},1024),t(xe,{modelValue:c.value[`${e.title}#domain#${e.host}`],"onUpdate:modelValue":g=>c.value[`${e.title}#domain#${e.host}`]=g,items:v.children,"item-value":"title","item-key":"id",headers:N(e.title,e.host),"return-object":"","show-select":"","show-expand":""},{"expanded-row":l(({columns:g,item:y})=>[y.children?(h(),J("tr",_t,[B("td",{colspan:g.length},[t(E,{color:"#0377a1",variant:"tonal",class:"mx-auto my-1 py-1 mx-n2"},{default:l(()=>[B("div",xt,M(U(y.children)),1)]),_:2},1024),t(xe,{modelValue:c.value[`${e.title}#domain#${e.host}`],"onUpdate:modelValue":x=>c.value[`${e.title}#domain#${e.host}`]=x,headers:N(e.title,e.host),items:y.children,"item-value":"title","item-key":"id","return-object":"","show-select":""},null,8,["modelValue","onUpdate:modelValue","headers","items"])],8,kt)])):ne("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue","items","headers"])],8,Vt)],8,yt)):ne("",!0)]),_:2},1032,["modelValue","onUpdate:modelValue","items","headers"])]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1}),t(se,{align:"center",justify:"center"},{default:l(()=>[t(re,null,{default:l(()=>[t(E,{class:"mb-8"},{default:l(()=>[t(de,{color:"cyan-darken-4",flat:""},{default:l(()=>[t(ie,null,{default:l(()=>[b("Files to link")]),_:1})]),_:1}),t(he,null,{default:l(()=>[t(se,{"no-gutters":""},{default:l(()=>[(h(!0),J(oe,null,ve(X.value,(e,k)=>(h(),L(re,{md:"6"},{default:l(()=>[t(m,{"item-value":"id",items:[e]},{prepend:l(({item:f,open:v})=>[f.types?(h(),L(ye,{key:1,color:"teal-darken-2"},{default:l(()=>[b(M(ee.value[f.types]),1)]),_:2},1024)):(h(),L(ye,{key:0,icon:"$mdiApplicationOutline",color:"teal-darken-2"}))]),_:2},1032,["items"])]),_:2},1024))),256))]),_:1})]),_:1}),t(ze),t(Ke,null,{default:l(()=>[t(Ve),t(We,{modelValue:_.value,"onUpdate:modelValue":a[4]||(a[4]=e=>_.value=e),"max-width":"400",persistent:""},{activator:l(({props:e})=>[t(Z,q({disabled:W.value,"append-icon":"$plus",color:"teal",text:"Save",variant:"flat"},e),null,16,["disabled"])]),default:l(()=>[t(E,null,{actions:l(()=>[t(Ve),t(Z,{color:"red-darken-4",onClick:a[3]||(a[3]=e=>_.value=!1),variant:"flat"},{default:l(()=>[b(" Cancel ")]),_:1}),t(Z,{color:"teal",onClick:w,variant:"flat"},{default:l(()=>[b(" Accept ")]),_:1})]),default:l(()=>[t(de,{color:"cyan-darken-4",flat:""},{append:l(()=>[t(Z,{icon:"$close",variant:"text",onClick:a[2]||(a[2]=e=>_.value=!1)})]),default:l(()=>[t(ie,null,{default:l(()=>[b("Save Items")]),_:1})]),_:1}),t(Qe,null,{default:l(()=>[b(" Do you want to link and saved the selected items? ")]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(d)]),_:1})]),_:1})],64)}}},Dt=document.getElementById("dataProviders").getAttribute("value")||"{}",It=document.getElementsByName("csrfmiddlewaretoken")[0].getAttribute("value")||"",Te=Ze(Tt,{dataProviders:Dt,csrf:It});Ce(Te);Te.mount("#app");
